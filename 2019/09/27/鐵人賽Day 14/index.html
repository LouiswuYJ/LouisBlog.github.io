<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

    <!--Description-->

    

    
        <meta name="description" content="不管用哪個程式語言或框架寫網站，多數會有資料庫的應用，資料與資料之間一定會有關聯性，那要如何在不同Model設立資料關係，這裏會用很簡單的例子去試著理解什麼是資料表關聯。
Active Record根據手冊：「Active Record 是 MVC 的 M（Model），表現商業邏輯與資料的層級，負"/>
    

    <!--Author-->
    
        <meta name="author" content="John Doe"/>
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="Day14: 淺談Model資料表關聯"/>
    

    <!--Open Graph Description-->
    
        <meta property="og:description" content="不管用哪個程式語言或框架寫網站，多數會有資料庫的應用，資料與資料之間一定會有關聯性，那要如何在不同Model設立資料關係，這裏會用很簡單的例子去試著理解什麼是資料表關聯。
Active Record根據手冊：「Active Record 是 MVC 的 M（Model），表現商業邏輯與資料的層級，負"/>
    

    <!--Open Graph Site Name-->
        <meta property="og:site_name" content="Hexo"/>

    <!--Type page-->
    
        <meta property="og:type" content="article"/>
    

    <!--Page Cover-->
    
    
        <meta property="og:image" content="http://yoursite.comhttp://www.codeblocq.com/assets/projects/hexo-theme-clean-blog/img/home-bg.jpg"/>
    

        <meta name="twitter:card" content="summary_large_image"/>

    

    
        <meta name="twitter:image" content="http://yoursite.comhttp://www.codeblocq.com/assets/projects/hexo-theme-clean-blog/img/home-bg.jpg"/>
    

    <!-- Title -->
    
    <title>Day14: 淺談Model資料表關聯 - Hexo</title>

    <!-- Bootstrap Core CSS -->
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet"/>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/>
    <link href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css"/>
    <link href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css"/>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet"/>

    <!-- Google Analytics -->
    


    <!-- favicon -->
    

</head>


<body>

    <!-- Menu -->
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Configurable Title</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                
                    <li>
                        <a href="/">
                            
                                Home
                            
                        </a>
                    </li>
                
                    <li>
                        <a href="/archives">
                            
                                Archives
                            
                        </a>
                    </li>
                
                    <li>
                        <a href="/tags">
                            
                                Tags
                            
                        </a>
                    </li>
                
                    <li>
                        <a href="/categories">
                            
                                Categories
                            
                        </a>
                    </li>
                
                    <li>
                        <a href="https://github.com/klugjo/hexo-theme-clean-blog" target="_blank" rel="noopener">
                            
                                <i class="fa fa-github fa-stack-2x"></i>
                            
                        </a>
                    </li>
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>

    <!-- Main Content -->
    <!-- Page Header -->
<!-- Set your background image for this header in your post front-matter: cover -->

<header class="intro-header" style="background-image: url('http://www.codeblocq.com/assets/projects/hexo-theme-clean-blog/img/home-bg.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>Day14: 淺談Model資料表關聯</h1>
                    
                    <span class="meta">
                        <!-- Date and Author -->
                        
                        
                            2019-09-27
                        
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

            <!-- Tags and categories -->
           
                <div class="col-lg-4 col-lg-offset-2 col-md-5 col-md-offset-1 post-tags">
                    
                        


<a href="/tags/鐵人賽/">#鐵人賽</a>


                    
                </div>
                <div class="col-lg-4 col-md-5 post-categories">
                    
                </div>
            

            <!-- Gallery -->
            

            <!-- Post Main Content -->
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <p>不管用哪個程式語言或框架寫網站，多數會有資料庫的應用，資料與資料之間一定會有關聯性，那要如何在不同Model設立資料關係，這裏會用很簡單的例子去試著理解什麼是資料表關聯。</p>
<h2 id="Active-Record"><a href="#Active-Record" class="headerlink" title="Active Record"></a>Active Record</h2><p>根據手冊：「Active Record 是 MVC 的 M（Model），表現商業邏輯與資料的層級，負責新增與操作需要持久存在資料庫裡的資料」</p>
<p>看起來有點抽象，在我的理解大概就是這個概念：</p>
<p>Active Record ＝ 把資料做成物件（是一種ORM框架）<br>物件 = 欄位 + 基本操作 + 商業邏輯</p>
<p>這樣寫似乎還是有點抽象，但其實可以想像成：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Model = ActiveRecord.new</span><br></pre></td></tr></table></figure>

<h2 id="用店面舉例"><a href="#用店面舉例" class="headerlink" title="用店面舉例"></a>用店面舉例</h2><p>先預設我們有3個Model:</p>
<ul>
<li>Owner</li>
<li>Stroe</li>
<li>Product</li>
</ul>
<p><img src="https://i.imgur.com/DLbomd0.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">o1 = Owner.create(name: &apos;Louis&apos;)</span><br></pre></td></tr></table></figure>

<p><img src="https://i.imgur.com/rNoho2g.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s1 = Store.new(title: &apos;Louis Shop&apos;)</span><br><span class="line">此時s1的owner_id還是空的</span><br></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/80ze79M.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">o1.store = s1</span><br><span class="line">把 Store 指定給 Owner</span><br><span class="line">s1的Owner_id就有3了</span><br></pre></td></tr></table></figure>

<h3 id="可用-create-本身包含-save"><a href="#可用-create-本身包含-save" class="headerlink" title="可用 create (本身包含.save)"></a>可用 create (本身包含.save)</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">o1 = Owner.create(name: &apos;Sherly&apos;)</span><br><span class="line">o1.create_store(title: &apos;Ruby Shop&apos;)</span><br></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/4e05pKT.png" alt=""></p>
<h3 id="用build-本身不包含save"><a href="#用build-本身不包含save" class="headerlink" title="用build(本身不包含save)"></a>用build(本身不包含save)</h3><p>還未.save前，可看到shop的id是空的</p>
<p><img src="https://i.imgur.com/wHv2AtF.png" alt=""></p>
<p>.save後</p>
<p><img src="https://i.imgur.com/owsFscG.png" alt=""><br><img src="https://i.imgur.com/D85OzMh.png" alt=""></p>
<h3 id="用new不會存進資料庫，必須額外-save"><a href="#用new不會存進資料庫，必須額外-save" class="headerlink" title="用new不會存進資料庫，必須額外.save"></a>用new不會存進資料庫，必須額外.save</h3><p><img src="https://i.imgur.com/GDgtmVc.png" alt=""></p>
<h3 id="用另一個角度"><a href="#用另一個角度" class="headerlink" title="用另一個角度"></a>用另一個角度</h3><p>只要有任一方有存入資料庫，就可以設定關聯性，不須雙方都存入資料庫</p>
<p><img src="https://i.imgur.com/cmkkdZf.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.create_store =&gt; 直接寫入資料庫</span><br><span class="line">.build_store =&gt;  建立，但未寫入資料庫</span><br></pre></td></tr></table></figure>

<h3 id="has-one"><a href="#has-one" class="headerlink" title="has_one"></a>has_one</h3><figure class="highlight plain"><figcaption><span>:store，產生以下四個方法:</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(類似 Cat = Animail.new的概念)</span><br><span class="line">•store</span><br><span class="line">•store=</span><br><span class="line">•build_store</span><br><span class="line">•create_store</span><br></pre></td></tr></table></figure>
<h3 id="belongs-to"><a href="#belongs-to" class="headerlink" title="belongs_to"></a>belongs_to</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">belongs_to 也是一個類別方法</span><br><span class="line">執行belongs_to :owner，只有產生以下兩個方法:</span><br><span class="line">•owner</span><br><span class="line">•owner=</span><br></pre></td></tr></table></figure>
<h3 id="has-many"><a href="#has-many" class="headerlink" title="has_many"></a>has_many</h3><figure class="highlight plain"><figcaption><span>:products，只有產生以下四個方法:</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">products</span><br><span class="line">products=</span><br><span class="line">build</span><br><span class="line">create</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#個別建立物件</span><br><span class="line">s1 = Store.first</span><br><span class="line">p1 = Product.new(name: &apos;iphone&apos;)</span><br><span class="line">p2 = Product.new(name: &apos;ipad&apos;)</span><br><span class="line"></span><br><span class="line">#方法一:可以一次塞入多個到s1</span><br><span class="line">s1.products = [p1, p2]</span><br><span class="line"></span><br><span class="line">#方法二:只能塞一個到s1</span><br><span class="line">s1.products.create(name: &apos;Mac&apos;)</span><br></pre></td></tr></table></figure>

<h3 id="has-many-through-多對多"><a href="#has-many-through-多對多" class="headerlink" title="has_many: through 多對多"></a>has_many: through 多對多</h3><p>跟has_many用起來差不多<br>需要第三方資料表來儲存兩邊資訊<br>第三方資料表通常只存放兩邊id，並且belong_to兩邊的Model</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rails g WareHouse sotre:references product:references</span><br><span class="line"></span><br><span class="line">或</span><br><span class="line"></span><br><span class="line">rails g WareHouse sotre_id:<span class="built_in">integer</span> product_id:<span class="built_in">integer</span></span><br></pre></td></tr></table></figure>

<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#store.rb</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Store</span> &lt; ApplicationRecord</span></span><br><span class="line">  has_many <span class="symbol">:ware_houses</span></span><br><span class="line">  has_many <span class="symbol">:products</span>, <span class="symbol">through:</span> <span class="symbol">:ware_houses</span> <span class="comment">#透過第三方</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#product.rb</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Product</span> &lt; ApplicationRecord</span></span><br><span class="line">  <span class="comment"># belongs_to :store</span></span><br><span class="line">  has_many <span class="symbol">:ware_houses</span></span><br><span class="line">  has_many <span class="symbol">:stores</span>, <span class="symbol">through:</span> <span class="symbol">:ware_houses</span> <span class="comment">#透過第三方</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">s1 = Store.first</span><br><span class="line">s2 = Store.second</span><br><span class="line">p1 = Product.first</span><br><span class="line">p2 = Product.second</span><br><span class="line">p3 = Product.third</span><br></pre></td></tr></table></figure>

<p>試著建立這樣的關係：</p>
<p><img src="https://i.imgur.com/fCOx69y.png" alt=""></p>
<p><img src="https://i.imgur.com/Nn24Kip.png" alt=""><br><img src="https://i.imgur.com/mGlKdse.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">下圖:</span><br><span class="line">p2.stores -&gt;p2商品再哪間店有貨</span><br><span class="line">s1.owner  -&gt;s1店面的店長是誰</span><br><span class="line">s2.products -&gt; s2店面有哪些商品</span><br></pre></td></tr></table></figure>

<p><img src="https://i.imgur.com/I6R7ybA.png" alt=""></p>
<p>參考資料：<br><a href="https://railsbook.tw/chapters/16-model-basic.html" target="_blank" rel="noopener">Model 基本操作</a></p>
<blockquote>
<p>“I realized early on that success was tied to not giving up. Most people in this business gave up and went on to other things. If you simply didn’t give up, you would outlast the people who came in on the bus with you.”</p>
<p>— Harrison Ford, Actor</p>
</blockquote>


                
            </div>

            <!-- Comments -->
            
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    


                </div>
            
        </div>
    </div>
</article>

    <!-- Footer -->
    <hr />

<!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    

                    

                    
                        <li>
                            <a href="https://github.com/klugjo/hexo-theme-clean-blog" target="_blank">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                    

                    

                    

                    
                </ul>
                <p class="copyright text-muted">&copy; 2019 John Doe<br></p>
                <p class="copyright text-muted">Original Theme <a target="_blank" href="http://startbootstrap.com/template-overviews/clean-blog/">Clean Blog</a> from <a href="http://startbootstrap.com/" target="_blank">Start Bootstrap</a></p>
                <p class="copyright text-muted">Adapted for <a target="_blank" href="https://hexo.io/">Hexo</a> by <a href="http://www.codeblocq.com/" target="_blank">Jonathan Klughertz</a></p>
            </div>
        </div>
    </div>
</footer>


    <!-- After footer scripts -->
    
<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Bootstrap -->
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Disqus Comments -->



</body>

</html>